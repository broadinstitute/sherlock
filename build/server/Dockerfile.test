# This Docerfile is used soley for integration tests
# It facilitates running integration tests locally against a real postgres
# instance via docker-compose

ARG GO_VERSION='1.16'
ARG ALPINE_VERSION='3.14'

FROM golang:${GO_VERSION}-alpine${ALPINE_VERSION} as build

#This is so that we can use cgo which is required for race condition detection
RUN apk add --no-cache git make build-base

WORKDIR /build
ENV CGO_ENABLED=1
ENV GO111MODULE=on
ENV GOBIN=/bin
COPY . .
CMD go test -v -race ./...
